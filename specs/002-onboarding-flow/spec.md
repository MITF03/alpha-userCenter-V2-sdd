# Feature Specification: 首頁註冊流程

**Feature Branch**: `002-onboarding-flow`  
**Created**: 2025-01-27  
**Status**: Draft  
**Input**: User description: "首頁要有三個功能 這三個功能是連動的 如果前面的功能沒有完成的話 不能夠實作後面的功能 這三個功能分別為: 成為投顧會員 開戶 簽署三方合約 並且點擊遮三個功能時 要跟 okamaga 連動"

## User Scenarios & Testing _(mandatory)_

### User Story 1 - 首頁開戶狀態檢查 (Priority: P1)

使用者首次進入首頁時，系統需要檢查客戶是否已經開戶，如果尚未開戶則顯示跳窗提醒。

**Why this priority**: 這是使用者進入系統的第一個互動點，必須在顯示其他功能前先檢查開戶狀態，確保使用者了解當前需要完成的步驟。這是整個註冊流程的入口檢查功能。

**Independent Test**: 可以透過以下方式獨立測試：使用者首次進入首頁，系統檢查開戶狀態，如果未開戶則顯示跳窗提醒，使用者可以關閉跳窗或點擊跳窗中的按鈕開始開戶流程。此功能可獨立運作並提供價值，即使其他註冊功能尚未完成。

**Acceptance Scenarios**:

1. **Given** 使用者首次進入首頁, **When** 系統載入完成, **Then** 系統自動檢查客戶的開戶狀態
2. **Given** 系統檢查開戶狀態, **When** 發現客戶尚未開戶, **Then** 系統顯示跳窗提醒，告知使用者需要完成開戶
3. **Given** 系統顯示開戶提醒跳窗, **When** 使用者點擊跳窗中的「前往開戶」按鈕, **Then** 系統導向開戶流程或啟用開戶功能
4. **Given** 系統顯示開戶提醒跳窗, **When** 使用者點擊「關閉」或「稍後提醒」, **Then** 系統關閉跳窗，使用者可以繼續使用首頁其他功能
5. **Given** 系統檢查開戶狀態, **When** 發現客戶已完成開戶, **Then** 系統不顯示跳窗提醒，正常顯示首頁內容
6. **Given** 使用者已看過開戶提醒跳窗並關閉, **When** 再次進入首頁, **Then** 系統根據設定決定是否再次顯示提醒（可設定為不再顯示或間隔一段時間後再次提醒）

---

### User Story 2 - 成為投顧會員 (Priority: P2)

使用者需要先完成成為投顧會員的流程，這是後續開戶與簽署三方合約的前置條件。

**Why this priority**: 成為投顧會員是整個註冊流程的第一步，必須先完成才能進行後續步驟。這是建立使用者身份與會員資格的核心功能。

**Independent Test**: 可以透過以下方式獨立測試：使用者進入首頁，點擊「成為投顧會員」功能，完成會員註冊流程，系統記錄會員狀態。此功能可獨立運作並提供價值，即使後續開戶與簽署合約功能尚未完成。

**Acceptance Scenarios**:

1. **Given** 使用者進入首頁, **When** 點擊「成為投顧會員」按鈕, **Then** 系統觸發與 okamaga 系統的連動事件，開始會員註冊流程
2. **Given** 系統觸發 okamaga 連動事件, **When** okamaga 系統回應成功, **Then** 系統記錄會員註冊狀態，並啟用「開戶」功能按鈕
3. **Given** 使用者尚未完成會員註冊, **When** 嘗試點擊「開戶」或「簽署三方合約」功能, **Then** 系統提示使用者需先完成會員註冊
4. **Given** 使用者已完成會員註冊, **When** 查看首頁, **Then** 「成為投顧會員」功能顯示為已完成狀態，「開戶」功能按鈕啟用

---

### User Story 3 - 開戶 (Priority: P3)

使用者完成成為投顧會員後，需要進行開戶流程，這是簽署三方合約的前置條件。

**Why this priority**: 開戶是投資服務的核心流程，必須在成為會員後才能進行。開戶完成後才能進行三方合約簽署。

**Independent Test**: 可以透過以下方式獨立測試：已完成會員註冊的使用者點擊「開戶」功能，完成開戶流程，系統記錄開戶狀態。此功能可獨立測試，前提是會員註冊已完成。

**Acceptance Scenarios**:

1. **Given** 使用者已完成會員註冊, **When** 點擊「開戶」按鈕, **Then** 系統觸發與 okamaga 系統的連動事件，開始開戶流程
2. **Given** 系統觸發 okamaga 連動事件, **When** okamaga 系統回應開戶成功, **Then** 系統記錄開戶狀態，並啟用「簽署三方合約」功能按鈕
3. **Given** 使用者尚未完成開戶, **When** 嘗試點擊「簽署三方合約」功能, **Then** 系統提示使用者需先完成開戶
4. **Given** 使用者已完成開戶, **When** 查看首頁, **Then** 「開戶」功能顯示為已完成狀態，「簽署三方合約」功能按鈕啟用
5. **Given** 使用者尚未完成會員註冊, **When** 嘗試點擊「開戶」功能, **Then** 系統提示使用者需先完成會員註冊

---

### User Story 4 - 簽署三方合約 (Priority: P4)

使用者完成開戶後，需要簽署三方合約以完成整個註冊流程。

**Why this priority**: 簽署三方合約是註冊流程的最後一步，完成後使用者才能正式使用投資服務。雖然重要，但必須在完成前兩個步驟後才能進行。

**Independent Test**: 可以透過以下方式獨立測試：已完成開戶的使用者點擊「簽署三方合約」功能，完成合約簽署流程，系統記錄簽署狀態。此功能可獨立測試，前提是會員註冊與開戶已完成。

**Acceptance Scenarios**:

1. **Given** 使用者已完成開戶, **When** 點擊「簽署三方合約」按鈕, **Then** 系統觸發與 okamaga 系統的連動事件，開始合約簽署流程
2. **Given** 系統觸發 okamaga 連動事件, **When** okamaga 系統回應合約簽署成功, **Then** 系統記錄合約簽署狀態，所有註冊流程完成
3. **Given** 使用者尚未完成開戶, **When** 嘗試點擊「簽署三方合約」功能, **Then** 系統提示使用者需先完成開戶
4. **Given** 使用者已完成合約簽署, **When** 查看首頁, **Then** 「簽署三方合約」功能顯示為已完成狀態，所有註冊流程完成
5. **Given** 使用者尚未完成會員註冊或開戶, **When** 嘗試點擊「簽署三方合約」功能, **Then** 系統提示使用者需先完成前置步驟

---

### Edge Cases

- 當使用者首次進入首頁但系統無法檢查開戶狀態時，系統如何處理？
- 當開戶狀態檢查回應時間過長時，系統如何處理載入狀態？
- 當使用者關閉開戶提醒跳窗後，系統應該多久後再次顯示提醒（如需要）？
- 當使用者選擇「稍後提醒」後，系統如何決定下次提醒的時機？
- 當使用者點擊功能按鈕但 okamaga 系統暫時無法連線時，系統如何處理？
- 當前端觸發 okamaga 連動事件但 okamaga 系統回應失敗時，系統如何處理與顯示？
- 當使用者已完成某個步驟但系統狀態未更新時，如何處理狀態不一致？
- 當使用者同時在多個裝置進行操作時，系統如何確保狀態一致性？
- 當 okamaga 系統回傳錯誤或失敗狀態時，系統如何處理與顯示？
- 當使用者中途離開流程，再次進入時系統如何顯示當前進度？
- 當使用者已完成所有步驟後，再次點擊功能按鈕時系統如何處理？
- 當前端事件綁定失敗或 okamaga 系統無回應時，系統如何處理超時情況？

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: 系統必須在使用者首次進入首頁時，自動檢查客戶的開戶狀態
- **FR-002**: 系統必須在檢查到客戶尚未開戶時，顯示跳窗提醒
- **FR-003**: 系統必須在跳窗中提供「前往開戶」按鈕，引導使用者進行開戶
- **FR-004**: 系統必須在跳窗中提供「關閉」或「稍後提醒」選項
- **FR-005**: 系統必須在客戶已完成開戶時，不顯示開戶提醒跳窗
- **FR-006**: 系統必須記錄使用者是否已看過提醒跳窗，避免重複顯示（可設定）
- **FR-007**: 系統必須在首頁顯示三個功能按鈕：「成為投顧會員」、「開戶」、「簽署三方合約」
- **FR-008**: 系統必須根據使用者完成狀態，動態啟用或停用功能按鈕
- **FR-009**: 系統必須在點擊「成為投顧會員」時，前端觸發事件並與 okamaga 系統連動，開始會員註冊流程
- **FR-010**: 系統必須在點擊「開戶」時，前端觸發事件並與 okamaga 系統連動，開始開戶流程
- **FR-011**: 系統必須在點擊「簽署三方合約」時，前端觸發事件並與 okamaga 系統連動，開始合約簽署流程
- **FR-012**: 系統必須在 okamaga 系統回應操作結果後，同步更新本系統的狀態
- **FR-013**: 系統必須在使用者尚未完成「成為投顧會員」時，停用「開戶」與「簽署三方合約」功能
- **FR-014**: 系統必須在使用者尚未完成「開戶」時，停用「簽署三方合約」功能
- **FR-015**: 系統必須在使用者嘗試點擊未啟用的功能時，顯示適當的提示訊息
- **FR-016**: 系統必須顯示每個功能的完成狀態（已完成/未完成）
- **FR-017**: 系統必須與 okamaga 系統進行狀態同步，確保資料一致性
- **FR-018**: 系統必須處理 okamaga 系統連線失敗的情況，提供適當的錯誤訊息
- **FR-019**: 系統必須記錄使用者的註冊流程進度，供後續查詢使用
- **FR-020**: 系統必須定期或即時檢查 okamaga 系統的狀態，並更新本系統的完成狀態
- **FR-021**: 系統必須驗證使用者身份，確保只有授權使用者可以進行註冊流程
- **FR-022**: 系統必須在 okamaga 系統操作失敗時，允許使用者重新嘗試
- **FR-023**: 系統必須提供清晰的視覺指示，顯示當前可進行的步驟與已完成的步驟

### Key Entities _(include if feature involves data)_

- **使用者 (User)**: 進行註冊流程的使用者，具有會員狀態、開戶狀態、合約簽署狀態等屬性
- **註冊流程狀態 (OnboardingStatus)**: 記錄使用者的註冊流程進度，包含會員註冊狀態、開戶狀態、合約簽署狀態、最後更新時間等
- **提醒記錄 (ReminderRecord)**: 記錄開戶提醒跳窗的顯示狀態，包含是否已顯示、顯示時間、使用者選擇（前往開戶/稍後提醒）等
- **okamaga 整合記錄 (OkamagaIntegrationLog)**: 記錄與 okamaga 系統的互動記錄，包含操作類型、操作時間、操作結果、錯誤訊息等

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: 系統能夠在 2 秒內完成開戶狀態檢查並顯示結果（跳窗或正常首頁）
- **SC-002**: 90% 的使用者能夠理解開戶提醒跳窗的內容，並知道如何進行下一步
- **SC-003**: 使用者能夠在 5 分鐘內完成「成為投顧會員」流程（從點擊按鈕到 okamaga 系統回應並更新狀態）
- **SC-004**: 使用者能夠在 10 分鐘內完成完整的註冊流程（三個步驟全部完成）
- **SC-005**: 95% 的使用者能夠成功完成第一個步驟（成為投顧會員），無需額外協助
- **SC-006**: 系統能夠在 3 秒內觸發與 okamaga 系統的連動事件並獲得回應
- **SC-007**: 系統能夠在 5 秒內同步 okamaga 系統的狀態更新
- **SC-008**: 90% 的使用者能夠理解功能按鈕的啟用/停用狀態，並知道下一步該做什麼
- **SC-009**: 系統與 okamaga 系統的狀態同步準確率達到 99% 以上
- **SC-010**: 當 okamaga 系統無法連線時，系統能夠在 2 秒內顯示適當的錯誤訊息
